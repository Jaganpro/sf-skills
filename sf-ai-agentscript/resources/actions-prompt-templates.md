# Prompt Template Actions

> Invoking Salesforce Prompt Templates as actions within Agent Script

**Navigation**: [← Back to Index](actions-INDEX.md)

---

## Overview

Prompt Template Actions enable invoking Salesforce Prompt Templates as actions within Agent Script, allowing agents to pass inputs to templates and return generated responses while maintaining simple, repeatable logic.

**Key Pattern**: Let prompt templates handle content generation while agents manage conversation flow.

---

## Action Target Syntax

```agentscript
target: "generatePromptResponse://<TemplateName>"
```

---

## Input Binding Pattern

Prompt inputs use the pattern `"Input:<apiName>"`, matching the template's input field API names:

```agentscript
inputs:
  "Input:email": string
    description: "User's email address"
    is_required: True
  "Input:customerName": string
    description: "Customer's full name"
    is_required: True
```

**CRITICAL**: Input parameter names must be quoted and follow the `"Input:fieldName"` format.

---

## Complete Example: Action Definition

```agentscript
actions:
  Generate_Personalized_Schedule:
    description: "Generate a personalized schedule with a prompt template"
    inputs:
      "Input:email": string
        description: "User's email address"
        is_required: True
      "Input:preferences": string
        description: "User's scheduling preferences"
        is_required: False
    outputs:
      promptResponse: string
        description: "The personalized schedule generated by the template"
        is_used_by_planner: True
        is_displayable: True
    target: "generatePromptResponse://Generate_Personalized_Schedule"
```

---

## Action Invocation

```agentscript
topic schedule_generation:
  reasoning:
    actions:
      generate_schedule: @actions.Generate_Personalized_Schedule
        with "Input:email"=@variables.user_email
             "Input:preferences"=...
        set @variables.schedule = @outputs.promptResponse
```

**Note**: Input parameters must be quoted when invoking: `"Input:email"=value`

---

## Output Handling

### Standard Output Field

Prompt templates always return `promptResponse`:

```agentscript
outputs:
  promptResponse: string
    description: "The prompt response generated by the action"
    is_used_by_planner: True      # LLM can reason about content
    is_displayable: True           # LLM can show to user
```

### Capturing Output

```agentscript
generate_content: @actions.Generate_Email_Draft
  with "Input:subject"=...
       "Input:recipient"=@variables.customer_name
  set @variables.draft = @outputs.promptResponse
```

---

## Grounded Data Integration

Templates can integrate data providers (such as Apex data providers) to supply contextual, relevant information for personalized responses.

### Pattern: Template + Data Provider

```agentscript
# Action uses template with grounded data
actions:
  Get_Product_Recommendations:
    description: "Generate personalized product recommendations"
    inputs:
      "Input:customerId": string
        description: "Customer ID for personalization"
        is_required: True
    outputs:
      promptResponse: string
        description: "Personalized recommendations"
        is_displayable: True
    target: "generatePromptResponse://Product_Recommender"

# Template configuration (in Setup) includes:
# - Data Provider: Apex class fetching customer purchase history
# - Grounding: Recent orders, preferences, browsing history
```

---

## Topic Organization

Keep input collection and action execution within focused topics to maintain predictable agent behavior:

```agentscript
topic personalized_content:
  description: "Generate personalized content for customer"
  reasoning:
    instructions: ->
      | I'll create personalized content for you.

    actions:
      generate_content: @actions.Generate_Personalized_Content
        with "Input:customerId"=@variables.customer_id
             "Input:contentType"=...
        set @variables.content = @outputs.promptResponse
```

---

## Best Practices

### ✅ DO

- **Separation of Concerns**: Let prompt templates handle content generation while agents manage conversation flow
- **Clear Input Requirements**: Define required inputs explicitly to avoid execution delays
- **Displayable Outputs**: Mark `promptResponse` as displayable for user-facing content
- **Descriptive Names**: Use clear input field names that match template configuration
- **Quote Parameters**: Always quote input parameter names (`"Input:fieldName"`)

### ❌ DON'T

- Mix too many concerns in a single prompt template action
- Forget to quote input parameter names
- Use prompt templates for simple data retrieval (use regular actions instead)
- Overcomplicate template inputs (keep them focused)
- Skip testing template responses with various inputs

---

## Common Patterns

### Pattern 1: Content Generation

```agentscript
generate_email: @actions.Generate_Email_Response
  with "Input:customerMessage"=@variables.user_message
       "Input:tone"="professional"
       "Input:context"=@variables.case_context
  set @variables.email_draft = @outputs.promptResponse
```

### Pattern 2: Summarization

```agentscript
summarize_conversation: @actions.Summarize_Conversation
  with "Input:conversationHistory"=@variables.chat_history
       "Input:maxLength"="500"
  set @variables.summary = @outputs.promptResponse
```

### Pattern 3: Personalized Recommendations

```agentscript
get_recommendations: @actions.Get_Product_Recommendations
  with "Input:customerId"=@variables.customer_id
       "Input:category"=...
  set @variables.recommendations = @outputs.promptResponse
```

---

## Troubleshooting

### Common Issue: Input Parameter Format

```agentscript
# ❌ WRONG - Missing quotes
with Input:email=@variables.user_email

# ✅ CORRECT - Quoted parameter name
with "Input:email"=@variables.user_email
```

### Common Issue: Action Chaining with Prompt Templates

Known limitation when using `run` keyword with prompt template actions:

```agentscript
# ⚠️ MAY NOT WORK with Prompt Templates in chained actions:
run @actions.transform_recommendation
  with "Input:Reco_Input" = @variables.ProductReco

# ✅ WORKAROUND - Call as primary action instead:
transform: @actions.transform_recommendation
  with "Input:Reco_Input" = @variables.ProductReco
```

See [actions-callbacks.md](actions-callbacks.md) for more on action chaining limitations.

---

## Testing Prompt Template Actions

### Validation Checklist

- [ ] Template exists in org and is active
- [ ] Input field API names match template configuration
- [ ] All required inputs are provided
- [ ] Output is captured to variable
- [ ] Template response quality meets expectations
- [ ] Grounded data (if used) is accurate and relevant
- [ ] Response time is acceptable for user experience

---

## Template Design Guidelines

When creating prompt templates for use in Agent Script:

1. **Clear Inputs**: Define input fields with descriptive API names
2. **Focused Purpose**: One template = one specific task
3. **Consistent Format**: Standardize output format for parsing
4. **Error Handling**: Template should handle missing/invalid inputs gracefully
5. **Performance**: Optimize for response time (use grounding judiciously)

---

## Related Topics

- **Prerequisites**: [actions-definitions.md](actions-definitions.md) - Action structure basics
- **Related**: [actions-input-bindings.md](actions-input-bindings.md) - Input parameter patterns
- **Troubleshooting**: [actions-troubleshooting.md](actions-troubleshooting.md) - Fix prompt template errors

---

## Additional Resources

- [Salesforce Prompt Builder Documentation](https://help.salesforce.com/s/articleView?id=sf.prompt_builder_overview.htm)
- [Agent Script Recipes - Prompt Template Actions](https://developer.salesforce.com/sample-apps/agent-script-recipes/action-configuration/prompt-template-actions)

---

*Part of the [Agent Script Actions Reference](actions-INDEX.md)*
