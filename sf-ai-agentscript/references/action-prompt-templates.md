<!-- Parent: sf-ai-agentscript/SKILL.md -->
   1 # Prompt Template Actions
   2 
   3 > Invoking Salesforce Prompt Templates as actions within Agent Script
   4 
   5 **Related**: [SKILL.md — Action Target Protocols](../SKILL.md) | [action-patterns.md](action-patterns.md)
   6 
   7 ---
   8 
   9 ## Overview
  10 
  11 Prompt Template Actions let agents invoke Salesforce Prompt Templates via the `generatePromptResponse://` protocol. The agent passes structured inputs to the template and receives a generated `promptResponse` output — keeping content generation in the template while the agent manages conversation flow.
  12 
  13 **When to use**: Personalized responses, summarization, content generation, recommendations — anything where an LLM prompt template produces better output than static Flow logic.
  14 
  15 ---
  16 
  17 ## Action Definition (Agentforce Assets)
  18 
  19 Define the action in **Setup > Agentforce > Action Definitions** (or via metadata API):
  20 
  21 ```agentscript
  22 actions:
  23   Generate_Personalized_Schedule:
  24     description: "Generate a personalized schedule using a prompt template"
  25     inputs:
  26       "Input:email": string
  27         description: "User's email address"
  28         is_required: True
  29       "Input:preferences": string
  30         description: "User's scheduling preferences"
  31         is_required: False
  32     outputs:
  33       promptResponse: string
  34         description: "The personalized schedule generated by the template"
  35         is_used_by_planner: True
  36         is_displayable: True
  37     target: "generatePromptResponse://Generate_Personalized_Schedule"
  38 ```
  39 
  40 ### Critical syntax rules
  41 
  42 | Rule | Example |
  43 |------|---------|
  44 | Target protocol | `"generatePromptResponse://TemplateName"` |
  45 | Input names **must be quoted** | `"Input:email"` not `Input:email` |
  46 | Input prefix is `Input:` | Matches the template's input field API name |
  47 | Output field is always `promptResponse` | Single string output from the template |
  48 
  49 ---
  50 
  51 ## Agent Script Invocation
  52 
  53 Reference the action definition in your `.agent` file:
  54 
  55 ```agentscript
  56 topic schedule_generation:
  57   reasoning:
  58     actions:
  59       generate_schedule: @actions.Generate_Personalized_Schedule
  60         with "Input:email"=@variables.user_email
  61              "Input:preferences"=...
  62         set @variables.schedule = @outputs.promptResponse
  63 ```
  64 
  65 **Input binding patterns** (same as regular actions):
  66 - `@variables.user_email` — variable binding (data from prior turns)
  67 - `...` — LLM slot-filling (extract from conversation)
  68 - `"professional"` — fixed value (business rule constant)
  69 
  70 ---
  71 
  72 ## Grounded Data Integration
  73 
  74 Templates can include **data providers** (Apex classes, Flows) that supply contextual data for personalized responses. The grounding happens inside the template — Agent Script only needs to pass the lookup key:
  75 
  76 ```agentscript
  77 actions:
  78   Get_Product_Recommendations:
  79     description: "Generate personalized product recommendations based on purchase history"
  80     inputs:
  81       "Input:customerId": string
  82         description: "Customer ID for personalization"
  83         is_required: True
  84     outputs:
  85       promptResponse: string
  86         description: "Personalized recommendations grounded in customer data"
  87         is_displayable: True
  88     target: "generatePromptResponse://Product_Recommender"
  89 ```
  90 
  91 The template itself (configured in Prompt Builder) includes:
  92 - **Data Provider**: Apex class fetching customer purchase history
  93 - **Grounding**: Recent orders, preferences, browsing history
  94 - **Template instructions**: How to format recommendations using the grounded data
  95 
  96 ---
  97 
  98 ## Common Patterns
  99 
 100 ### Pattern 1: Content Generation
 101 
 102 ```agentscript
 103 generate_email: @actions.Generate_Email_Response
 104   with "Input:customerMessage"=@variables.user_message
 105        "Input:tone"="professional"
 106        "Input:context"=@variables.case_context
 107   set @variables.email_draft = @outputs.promptResponse
 108 ```
 109 
 110 ### Pattern 2: Summarization
 111 
 112 ```agentscript
 113 summarize: @actions.Summarize_Conversation
 114   with "Input:conversationHistory"=@variables.chat_history
 115        "Input:maxLength"="500"
 116   set @variables.summary = @outputs.promptResponse
 117 ```
 118 
 119 ### Pattern 3: Personalized Recommendations
 120 
 121 ```agentscript
 122 recommend: @actions.Get_Product_Recommendations
 123   with "Input:customerId"=@variables.customer_id
 124        "Input:category"=...
 125   set @variables.recommendations = @outputs.promptResponse
 126 ```
 127 
 128 ---
 129 
 130 ## Known Limitation: `run` Keyword with Prompt Templates
 131 
 132 Chained actions using `run` may not properly map `"Input:X"` parameters:
 133 
 134 ```agentscript
 135 # ❌ MAY NOT WORK — run + prompt template input binding:
 136 process: @actions.create_order
 137   with customer_id=@variables.customer_id
 138   run @actions.Generate_Order_Summary
 139     with "Input:orderId"=@variables.order_id    # Input binding may fail
 140 
 141 # ✅ WORKAROUND — call as primary action instead:
 142 generate_summary: @actions.Generate_Order_Summary
 143   with "Input:orderId"=@variables.order_id      # Works as primary action
 144   set @variables.summary = @outputs.promptResponse
 145 ```
 146 
 147 > See SKILL.md "Action Chaining with `run` Keyword" for the full known bug description.
 148 
 149 ---
 150 
 151 ## Common Errors
 152 
 153 | Error | Cause | Fix |
 154 |-------|-------|-----|
 155 | `SyntaxError` on input binding | Missing quotes on parameter name | Use `"Input:email"` not `Input:email` |
 156 | Template not found | Wrong protocol or template name | Verify `generatePromptResponse://ExactTemplateName` |
 157 | Empty `promptResponse` | Template inactive or missing required inputs | Activate template in Setup, check all `is_required: True` inputs are bound |
 158 | Input not mapped | API name mismatch | Input field name after `Input:` must exactly match template's input API name |
 159 
 160 ---
 161 
 162 ## Checklist
 163 
 164 - [ ] Template exists in org and is **active**
 165 - [ ] Input field API names match template configuration exactly
 166 - [ ] All `is_required: True` inputs are bound (via `...`, `@variables`, or fixed)
 167 - [ ] `promptResponse` output is captured with `set`
 168 - [ ] Template response quality tested with representative inputs
 169 - [ ] If using grounded data: data provider returns expected records
 170 
 171 ---
 172 
 173 *Consolidated from @kunello's [PR #20](https://github.com/Jaganpro/sf-skills/pull/20) research on Agent Script Recipes action configuration patterns.*
