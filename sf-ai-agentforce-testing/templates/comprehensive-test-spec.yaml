# Comprehensive Test Specification Template
# Full coverage template for production-ready agent testing
#
# Compatible with: sf agent test create --spec <file> --api-name <name>
#
# Usage:
#   1. Replace all [placeholders] with actual values
#   2. Add/remove test cases as needed for your agent
#   3. Ensure every topic and action has at least one test
#   4. Create: sf agent test create --spec comprehensive-test-spec.yaml --api-name [Test_Name] --target-org [alias]
#   5. Run:    sf agent test run --api-name [Test_Name] --wait 10 --result-format json --target-org [alias]
#
# IMPORTANT: This YAML is parsed by @salesforce/agents — NOT a generic AiEvaluationDefinition format.
# Only the fields below are recognized. Do NOT add apiVersion, kind, metadata, or settings.

# Required: Display name for the test (MasterLabel) — deploy FAILS without this
name: "[Agent_Name] Comprehensive Tests"

# Required: Must be AGENT
subjectType: AGENT

# Required: Agent BotDefinition DeveloperName (API name)
subjectName: [Agent_Name]

testCases:
  # ═══════════════════════════════════════════════════════════════
  # TOPIC ROUTING TESTS
  # Goal: 100% topic coverage with 3+ phrasings per topic
  # ═══════════════════════════════════════════════════════════════

  # --- Topic 1: [topic_name] ---
  - utterance: "[Primary phrasing for topic 1]"
    expectedTopic: [topic_name]

  - utterance: "[Alternative phrasing for topic 1]"
    expectedTopic: [topic_name]

  - utterance: "[Informal/casual phrasing for topic 1]"
    expectedTopic: [topic_name]

  # --- Topic 2: [another_topic] ---
  - utterance: "[Primary phrasing for topic 2]"
    expectedTopic: [another_topic]

  - utterance: "[Alternative phrasing for topic 2]"
    expectedTopic: [another_topic]

  - utterance: "[Informal phrasing for topic 2]"
    expectedTopic: [another_topic]

  # Add more topics as needed...

  # ═══════════════════════════════════════════════════════════════
  # ACTION INVOCATION TESTS
  # Goal: 100% action coverage
  # expectedActions is a FLAT list of action name strings
  # ═══════════════════════════════════════════════════════════════

  # --- Action 1: [action_name] ---
  - utterance: "[Message that triggers action 1]"
    expectedTopic: [relevant_topic]
    expectedActions:
      - [action_name]

  - utterance: "[Alternative message for action 1]"
    expectedTopic: [relevant_topic]
    expectedActions:
      - [action_name]

  # --- Action 2: [another_action] ---
  - utterance: "[Message that triggers action 2]"
    expectedTopic: [relevant_topic]
    expectedActions:
      - [another_action]

  # --- Multiple actions in one test ---
  - utterance: "[Message that should trigger both actions]"
    expectedTopic: [relevant_topic]
    expectedActions:
      - [action_name]
      - [another_action]

  # ═══════════════════════════════════════════════════════════════
  # OUTCOME VALIDATION TESTS
  # expectedOutcome is a natural language description of the
  # expected agent response — evaluated by LLM-as-judge
  # ═══════════════════════════════════════════════════════════════

  - utterance: "[Message with expected response]"
    expectedTopic: [topic_name]
    expectedOutcome: "Agent should provide specific information about [topic]"

  - utterance: "[Another message with outcome check]"
    expectedTopic: [another_topic]
    expectedOutcome: "Agent should acknowledge the request and provide next steps"

  # ═══════════════════════════════════════════════════════════════
  # ESCALATION TESTS
  # Standard topic "Escalation" uses localDeveloperName
  # ═══════════════════════════════════════════════════════════════

  - utterance: "I need to speak with a manager"
    expectedTopic: Escalation

  - utterance: "I want to talk to a real person"
    expectedTopic: Escalation

  - utterance: "This is ridiculous, I need human help"
    expectedTopic: Escalation

  # ═══════════════════════════════════════════════════════════════
  # EDGE CASE TESTS
  # Test unusual inputs — topic routing still applies
  # ═══════════════════════════════════════════════════════════════

  - utterance: "asdfkjh qwerty12345 !!@@##"
    expectedTopic: [expected_fallback_topic]

  - utterance: "Where is my ordr?"
    expectedTopic: [relevant_topic]

  # ═══════════════════════════════════════════════════════════════
  # MULTI-TURN CONVERSATION TESTS
  # Use conversationHistory to provide prior turns as context
  # ═══════════════════════════════════════════════════════════════

  - utterance: "When will it arrive?"
    expectedTopic: [relevant_topic]
    conversationHistory:
      - role: user
        message: "I want to check on order 12345"
      - role: agent
        topic: [relevant_topic]
        message: "I'd be happy to help you check on order 12345. Let me look that up."

  - utterance: "Yes, please do that"
    expectedTopic: [relevant_topic]
    expectedActions:
      - [create_case_action]
    conversationHistory:
      - role: user
        message: "My product is broken"
      - role: agent
        topic: [relevant_topic]
        message: "I'm sorry to hear that. I can help you create a support case."

# ═══════════════════════════════════════════════════════════════════════
# NOTES
#
# Topic Name Resolution:
#   Standard topics (Escalation, Off_Topic) → use localDeveloperName
#   Promoted topics (p_16j... prefix) → use FULL runtime developerName with hash
#   See docs/topic-name-resolution.md for details
#
# Action Assertions (superset matching):
#   Expected: [ActionA] / Actual: [ActionA, ActionB] → PASS
#   The CLI passes if the agent invokes AT LEAST the expected actions.
#
# Empty expectedActions:
#   expectedActions: [] means "not testing actions" → always PASS
#   Omitting expectedActions entirely has the same effect.
#
# Missing expectedOutcome:
#   Omitting expectedOutcome causes output_validation to report ERROR status.
#   This is HARMLESS — topic and action assertions still run normally.
#
# conversationHistory roles:
#   Use "user" and "agent" (NOT "assistant"). Agent entries need "topic" field.
# ═══════════════════════════════════════════════════════════════════════
